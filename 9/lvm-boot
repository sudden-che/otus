Script started on Fri 10 Dec 2021 11:20:44 AM MSK
]0;user@centos7:/data/33/9[?1034h[user@centos7 9]$ vagrant ssh
]0;vagrant@localhost:~[?1034h[vagrant@localhost ~]$ sudo su
]0;root@localhost:/home/vagrant[?1034h[root@localhost vagrant]# vgs
  VG         #PV #LV #SN Attr   VSize   VFree
  VolGroup00   1   2   0 wz--n- <38.97g    0 
]0;root@localhost:/home/vagrant[root@localhost vagrant]# [K[root@localhost vagrant]# vgrename VolGroup00 OtusRoot
  Volume group "VolGroup00" successfully renamed to "OtusRoot"
]0;root@localhost:/home/vagrant[root@localhost vagrant]# sed -i ""s"/"V"o"l"G"r"o"u"p"0"0"/"O"t"u"s"r"[1P"R"o"o"t"/"g"[C /etc/fstab 
]0;root@localhost:/home/vagrant[root@localhost vagrant]# sed -i "s/VolGroup00/OtusRoot/g" /etc/fstab [K[K[K[K[K[Kdefault/grub 
]0;root@localhost:/home/vagrant[root@localhost vagrant]# sed -i "s/VolGroup00/OtusRoot/g" /etc/default/grub [K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[Kboot/grub2/grub.cfg 
]0;root@localhost:/home/vagrant[root@localhost vagrant]# grep Otus /etc/fstab 
/dev/mapper/[01;31m[KOtus[m[KRoot-LogVol00 /                       xfs     defaults        0 0
/dev/mapper/[01;31m[KOtus[m[KRoot-LogVol01 swap                    swap    defaults        0 0
]0;root@localhost:/home/vagrant[root@localhost vagrant]# grep Otus /etc/fstab /d[Ketc/default/grub 
[35m[K/etc/fstab[m[K[36m[K:[m[K/dev/mapper/[01;31m[KOtus[m[KRoot-LogVol00 /                       xfs     defaults        0 0
[35m[K/etc/fstab[m[K[36m[K:[m[K/dev/mapper/[01;31m[KOtus[m[KRoot-LogVol01 swap                    swap    defaults        0 0
[35m[K/etc/default/grub[m[K[36m[K:[m[KGRUB_CMDLINE_LINUX="no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=[01;31m[KOtus[m[KRoot/LogVol00 rd.lvm.lv=[01;31m[KOtus[m[KRoot/LogVol01 rhgb quiet"
]0;root@localhost:/home/vagrant[root@localhost vagrant]# grep Otus /etc/fstab /etc/default/grub [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Kmkrinitrd[K[K[K[K[K[K[Kinitrd -f -v /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img [K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K#([K[K$(uname -r [K).img $(uname -r)
Executing: /sbin/dracut -f -v /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img 3.10.0-862.2.3.el7.x86_64
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
Omitting driver floppy
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** No early-microcode cpio image needed ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
]0;root@localhost:/home/vagrant[root@localhost vagrant]# reboot
Connection to 127.0.0.1 closed by remote host.
Connection to 127.0.0.1 closed.
]0;user@centos7:/data/33/9[user@centos7 9]$ vagrant ssh
Last login: Fri Dec 10 08:20:51 2021 from 10.0.2.2
]0;vagrant@localhost:~[?1034h[vagrant@localhost ~]$ sudo su
]0;root@localhost:/home/vagrant[?1034h[root@localhost vagrant]# vgs
  VG       #PV #LV #SN Attr   VSize   VFree
  OtusRoot   1   2   0 wz--n- <38.97g    0 
]0;root@localhost:/home/vagrant[root@localhost vagrant]# mkdir -p /usr/libd[K/dracut/modules.d/01test
]0;root@localhost:/home/vagrant[root@localhost vagrant]# touch module-mkdir -p /usr/lib/dracut/modules.d/01test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5P[C[3P/usr/lib/dracut/modules.d/01test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cc /usr/lib/dracut/modules.d/01test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cd /usr/lib/dracut/modules.d/01test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# touc [Kh o[Kmoud[K[Kdule-st[Ketup.sh
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# touch module-setup.shsh[Ktshesh[Cshtsh
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# rm -f [K[K[K[K[K[Krm[K[Kmv testsh test.sh
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# vi module-setup.sh 
[?1049h[?1h=[1;58r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[58;1H"module-setup.sh" 0L, 0C[2;1H[1m[34m~                                                                                                              [3;1H~                                                                                                              [4;1H~                                                                                                              [5;1H~                                                                                                              [6;1H~                                                                                                              [7;1H~                                                                                                              [8;1H~                                                                                                              [9;1H~                                                                                                              [10;1H~                                                                                                              [11;1H~                                                                                                              [12;1H~                                                                                                              [13;1H~                                                                                                              [14;1H~                                                                                                              [15;1H~                                                                                                              [16;1H~                                                                                                              [17;1H~                                                                                                              [18;1H~                                                                                                              [19;1H~                                                                                                              [20;1H~                                                                                                              [21;1H~                                                                                                              [22;1H~                                                                                                              [23;1H~                                                                                                              [24;1H~                                                                                                              [25;1H~                                                                                                              [26;1H~                                                                                                              [27;1H~                                                                                                              [28;1H~                                                                                                              [29;1H~                                                                                                              [30;1H~                                                                                                              [31;1H~                                                                                                              [32;1H~                                                                                                              [33;1H~                                                                                                              [34;1H~                                                                                                              [35;1H~                                                                                                              [36;1H~                                                                                                              [37;1H~                                                                                                              [38;1H~                                                                                                              [39;1H~                                                                                                              [40;1H~                                                                                                              [41;1H~                                                                                                              [42;1H~                                                                                                              [43;1H~                                                                                                              [44;1H~                                                                                                              [45;1H~                                                                                                              [46;1H~                                                                                                              [47;1H~                                                                                                              [48;1H~                                                                                                              [49;1H~                                                                                                              [50;1H~                                                                                                              [51;1H~                                                                                                              [52;1H~                                                                                                              [53;1H~                                                                                                              [54;1H~                                                                                                              [55;1H~                                                                                                              [56;1H~                                                                                                              [57;1H~                                                                                                              [1;1H[?12l[?25h[?25l[m[58;1H[1m-- INSERT --[m[58;13H[K[1;1H[?12l[?25h[?25l#!/bin/bash[2;1H[K[3;1Hcheck() {[3;10H[K[4;1H    return 0[4;13H[K[5;1H}[5;2H[K[6;1H[K[7;1Hdepends() {[7;12H[K[8;1H    return 0[8;13H[K[9;1H}[9;2H[K[10;1H[K[11;1Hinstall() {[11;12H[K[12;1H    inst_hook cleanup 00 "${moddir}/test.sh"[12;45H[K[13;1H}[13;2H[K[13;2H[?12l[?25h[58;1H[K[13;1H[?25l[?12l[?25h[?25l[58;1H:[?12l[?25hwq![?25l"module-setup.sh" 13L, 126C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# chmdo + x[K[Kx *
bash: chmdo: command not found
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# chmdo +x *[5P[1@c[1@h[1@m[1@d[1@o[1P[1P[1P[1@m[1@o[1@d
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# vi test.sh 
[?1049h[?1h=[1;58r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[58;1H"test.sh" 0L, 0C[2;1H[1m[34m~                                                                                                              [3;1H~                                                                                                              [4;1H~                                                                                                              [5;1H~                                                                                                              [6;1H~                                                                                                              [7;1H~                                                                                                              [8;1H~                                                                                                              [9;1H~                                                                                                              [10;1H~                                                                                                              [11;1H~                                                                                                              [12;1H~                                                                                                              [13;1H~                                                                                                              [14;1H~                                                                                                              [15;1H~                                                                                                              [16;1H~                                                                                                              [17;1H~                                                                                                              [18;1H~                                                                                                              [19;1H~                                                                                                              [20;1H~                                                                                                              [21;1H~                                                                                                              [22;1H~                                                                                                              [23;1H~                                                                                                              [24;1H~                                                                                                              [25;1H~                                                                                                              [26;1H~                                                                                                              [27;1H~                                                                                                              [28;1H~                                                                                                              [29;1H~                                                                                                              [30;1H~                                                                                                              [31;1H~                                                                                                              [32;1H~                                                                                                              [33;1H~                                                                                                              [34;1H~                                                                                                              [35;1H~                                                                                                              [36;1H~                                                                                                              [37;1H~                                                                                                              [38;1H~                                                                                                              [39;1H~                                                                                                              [40;1H~                                                                                                              [41;1H~                                                                                                              [42;1H~                                                                                                              [43;1H~                                                                                                              [44;1H~                                                                                                              [45;1H~                                                                                                              [46;1H~                                                                                                              [47;1H~                                                                                                              [48;1H~                                                                                                              [49;1H~                                                                                                              [50;1H~                                                                                                              [51;1H~                                                                                                              [52;1H~                                                                                                              [53;1H~                                                                                                              [54;1H~                                                                                                              [55;1H~                                                                                                              [56;1H~                                                                                                              [57;1H~                                                                                                              [1;1H[?12l[?25h[?25l[m[58;1H[1m-- INSERT --[m[58;13H[K[1;1H[?12l[?25h[?25l#!/bin/bash[2;1H[K[3;1Hexec 0<>/dev/console 1<>/dev/console 2<>/dev/console[3;53H[K[4;1Hcat <<'msgend'[4;15H[K[5;1HHello! You are in dracut module![5;33H[K[6;1H ___________________[6;21H[K[7;1H< I'm dracut module >[7;22H[K[8;1H -------------------[8;21H[K[9;1H   \[9;5H[K[10;1H    \[10;6H[K[11;1H        .--.[11;13H[K[12;1H       |o_o |[12;14H[K[13;1H       |:_/ |[13;14H[K[14;1H      //   \ \[14;15H[K[15;1H     (|     | )[15;16H[K[16;1H    /'\_   _/`\[16;16H[K[17;1H    \___)=(___/[17;16H[K[18;1Hmsgend[18;7H[K[19;1Hsleep 10[19;9H[K[20;1Hecho " continuing...."[20;23H[K[20;23H[?12l[?25h[19;9H[18;7H[19;9H[?25l0[19;8H[K[19;7H[?12l[?25h[?25l30[?12l[?25h[20;8H[?25l[20;1H[K[21;1Hecho " continuing...."[21;23H[K[21;1H[?12l[?25h[20;1H[19;1H[17;1H[16;1H[15;1H[14;1H[13;1H[12;1H[11;1H[10;1H[9;1H[8;1H[7;1H[6;1H[5;1H[4;1H[3;1H[2;1H[1;1H



















[20;1H[19;1H[18;1H[17;1H[16;1H[15;1H[13;1H[12;1H[11;1H[10;1H[9;1H[7;1H[6;1H[5;1H[4;1H[3;1H

















[20;1H[19;1H[?25lшsleep 30[19;2H[?12l[?25h[?25lsleep 30[19;9H[K[19;1H[?12l[?25h[?25lisleep 30i[?12l[?25h[?25lsleep 30[19;9H[K[19;1H[?12l[?25h[?25l[20;57r[20;1H[L[1;58r[19;1H[K[20;1Hsleep 30[?12l[?25h[?25l[21;57r[21;1H[L[1;58r[20;1H[K[21;1Hsleep 30[?12l[?25h[20;1H[?25le[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25lm[?12l[?25h[?25l[20;6H[K[20;6H[?12l[?25h[?25l'[?12l[?25h[?25lm[?12l[?25h[?25lo[?12l[?25h[?25lu[?12l[?25h[?25ld[?12l[?25h[?25le[?12l[?25h[?25ll[?12l[?25h[?25l [?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25l [?12l[?25h[?25l[?12l[?25h[?25l[20;17H[K[20;17H[?12l[?25h[?25l[20;15H[K[20;15H[?12l[?25h[?25l[20;14H[K[20;14H[?12l[?25h[?25l[20;12H[K[20;12H[?12l[?25h[?25l[20;11H[K[20;11H[?12l[?25h[?25l[20;10H[K[20;10H[?12l[?25h[?25l[20;9H[K[20;9H[?12l[?25h[?25ld[?12l[?25h[?25lu[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25l [?12l[?25h[?25ls[?12l[?25h[?25l[20;14H[K[20;14H[?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25l [?12l[?25h[?25li[?12l[?25h[?25ln[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25ld[?12l[?25h[?25l [?12l[?25h[?25l>[?12l[?25h[?25l [?12l[?25h[?25l/[?12l[?25h[?25l[20;31H[K[20;31H[?12l[?25h[21;9H[20;8Ho[?25lmodule test installed > echo [?12l[?25h[?25l"module test installed >[20;7H[?12l[?25h[?25l module test installed >[20;8H[?12l[?25h[?25lmodule test installed > [20;7H[?12l[?25h[?25l$module test installed >[20;8H[?12l[?25h[?25l(module test installed >[20;9H[?12l[?25h[?25ldmodule test installed >[20;10H[?12l[?25h[?25lamodule test installed >[20;11H[?12l[?25h[?25ltmodule test installed >[20;12H[?12l[?25h[?25ltmodule test installed >[20;13H[?12l[?25h[?25lmodule test installed > [20;12H[?12l[?25h[?25lemodule test installed >[20;13H[?12l[?25h[?25l)module test installed >[20;14H[?12l[?25h[?25l module test installed >[20;15H[?12l[?25h[24C[?25l" >[?12l[?25h > [?25l/[?12l[?25h[?25lv[?12l[?25h[?25la[?12l[?25h[?25lr[?12l[?25h[?25l/[?12l[?25h[?25ll[?12l[?25h[?25lo[?12l[?25h[?25lg[?12l[?25h[?25l/[?12l[?25h[?25ld[?12l[?25h[?25l[20;49H[K[20;49H[?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25l.[?12l[?25h[?25ll[?12l[?25h[?25lo[?12l[?25h[?25lg[?12l[?25h[58;1H[K[20;56H[?25l[?12l[?25h[?25l[58;1H:[?12l[?25hwq![?25l"test.sh" 23L, 391C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# mkinitrd -f -v /boot/[3P(reverse-i-search)`':[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@i[C[C[C[C[C[C[C[1@n[C[C[C[C[C[1@i[C[C[C[C[C[1@t[C[C[C[C[C^C
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# [3P(reverse-i-search)`':[Cm': chmod +x *k': mkdir -p /usr/lib/dracut/modules.d/01test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Ci': mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@n[C[C[C[1@i[C[C[C[1@t[C[C[C[1@r[C[C[C[1@d[C[C[C[1@ [C[C[C[1@-[C[C[C[7P[root@localhost 01test]#[C[Kdrecut [K[K[K[K[K[K[Kdrec[K[Ka cu[K[K[Kcut -f -v
Executing: /sbin/dracut -f -v
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
*** Including module: bash ***
*** Including module: test ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
Omitting driver floppy
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** No early-microcode cpio image needed ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# in[K[Klsinitrd -m /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img | grep test
[01;31m[Ktest[m[K
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# cat /gru[K[K[Kboot/grub.c[K[K/gru[K[K[Ksplash.xpm.gz 
module-setup.sh  test.sh          
[root@localhost 01test]# cat /boot/grub/splash.xpm.gz 
module-setup.sh  test.sh          
[root@localhost 01test]# cat /boot/grub/splash.xpm.gz [K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K
config-3.10.0-862.2.3.el7.x86_64         symvers-3.10.0-862.2.3.el7.x86_64.gz
efi/                                     System.map-3.10.0-862.2.3.el7.x86_64
grub/                                    vmlinuz-3.10.0-862.2.3.el7.x86_64
grub2/                                   .vmlinuz-3.10.0-862.2.3.el7.x86_64.hmac
initramfs-3.10.0-862.2.3.el7.x86_64.img  
[root@localhost 01test]# cat /boot/grub2/
device.map  fonts/      grub.cfg    grubenv     i386-pc/    locale/     
[root@localhost 01test]# cat /boot/grub2/grub.cfg 
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=1
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=1
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-862.2.3.el7.x86_64-advanced-b60e9498-0baa-4d9f-90aa-069048217fee' {
	load_video
	set gfxpayload=keep
	insmod gzio
	insmod part_msdos
	insmod xfs
	set root='hd0,msdos2'
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root --hint='hd0,msdos2'  570897ca-e759-4c81-90cf-389da6eee4cc
	else
	  search --no-floppy --fs-uuid --set=root 570897ca-e759-4c81-90cf-389da6eee4cc
	fi
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/OtusRoot-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=OtusRoot/LogVol00 rd.lvm.lv=OtusRoot/LogVol01 rhgb quiet 
	initrd16 /initramfs-3.10.0-862.2.3.el7.x86_64.img
}
if [ "x$default" = 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' ]; then default='Advanced options for CentOS Linux>CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)'; fi;
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# vicat /boot/grub2/grub.cfg [3P[1@v[1@i
[?1049h[?1h=[1;58r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[58;1H"/boot/grub2/grub.cfg" 127L, 3601C[1;1H#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi[1;1H[?12l[?25h[?25l[58;1H[K[58;1H/[?12l[?25hquit[?25l[31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: quit[m[58;30H[K[1;1H[?12l[?25h[?25l[58;1H[K[58;1H/[?12l[?25hquiet[?25l[27m[m[H[2J[2;1H### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --cll[15;1Hass os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-862.2.3.el7.x86_64-advanced-b60e9498-0baa-4d9f-90aaa[16;1H-069048217fee' {[17;9Hload_video[18;9Hset gfxpayload=keep[19;9Hinsmod gzio[20;9Hinsmod part_msdos[21;9Hinsmod xfs[22;9Hset root='hd0,msdos2'[23;9Hif [ x$feature_platform_search_hint = xy ]; then[24;11Hsearch --no-floppy --fs-uuid --set=root --hint='hd0,msdos2'  570897ca-e759-4c81-90cf-389da6eee4cc[25;9Helse[26;11Hsearch --no-floppy --fs-uuid --set=root 570897ca-e759-4c81-90cf-389da6eee4cc[27;9Hfi[28;9Hlinux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/OtusRoot-LogVol00 ro no_timer_check consolee[29;1H=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=OtusRoot/LogVV[30;1Hol00 rd.lvm.lv=OtusRoot/LogVol01 rhgb quiet[31;9Hinitrd16 /initramfs-3.10.0-862.2.3.el7.x86_64.img
}
if [ "x$default" = 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' ]; then default='Advanced options for Cee[34;1HntOS Linux>CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)'; fi;
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi[30;39H[?12l[?25h[31;57H[30;39H[?25l[58;1H[1m-- INSERT --[30;39H[?12l[?25h[?25l[muiet [?12l[?25h[?25liet [?12l[?25h[?25let [?12l[?25h[?25lt [?12l[?25h[?25l [?12l[?25h[?25l[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l[?12l[?25h[58;1H[K[30;32H[?25l[?12l[?25h[?25l[58;1H:[?12l[?25hwq![?25l"/boot/grub2/grub.cfg" 127L, 3590C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# grub2-mkconfig 
Generating grub configuration file ...
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=1
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=1
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
menuentry 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-862.2.3.el7.x86_64-advanced-b60e9498-0baa-4d9f-90aa-069048217fee' {
	load_video
	set gfxpayload=keep
	insmod gzio
	insmod part_msdos
	insmod xfs
	set root='hd0,msdos2'
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos2 --hint-efi=hd0,msdos2 --hint-baremetal=ahci0,msdos2  570897ca-e759-4c81-90cf-389da6eee4cc
	else
	  search --no-floppy --fs-uuid --set=root 570897ca-e759-4c81-90cf-389da6eee4cc
	fi
	linux16 /vmlinuz-3.10.0-862.2.3.el7.x86_64 root=/dev/mapper/OtusRoot-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=OtusRoot/LogVol00 rd.lvm.lv=OtusRoot/LogVol01 rhgb quiet 
	initrd16 /initramfs-3.10.0-862.2.3.el7.x86_64.img
}
if [ "x$default" = 'CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)' ]; then default='Advanced options for CentOS Linux>CentOS Linux (3.10.0-862.2.3.el7.x86_64) 7 (Core)'; fi;
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
done
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# grub2-mkconfig [9@vi /boot/grub2/grub.cf[C[C[1@cat[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P[1P[1P[1P[1@g[1@r[1@e[1@p[1@ [1@r[1@h[1@g[1@b
^C
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# grep rhgb/boot/grub2/grub.cfg [1@ 
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# grep rhgb /boot/grub2/grub.cfg [4P[1@q[1@u[1@i[1@e[1@t
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# ls /var/log/ | grep test
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# reboot
Connection to 127.0.0.1 closed by remote host.
Connection to 127.0.0.1 closed.
]0;user@centos7:/data/33/9[user@centos7 9]$ vagrant ssh
Last login: Fri Dec 10 08:30:08 2021 from 10.0.2.2
]0;vagrant@localhost:~[?1034h[vagrant@localhost ~]$ sudo su
]0;root@localhost:/home/vagrant[?1034h[root@localhost vagrant]# rebootls /var/log/ | grep test
]0;root@localhost:/home/vagrant[root@localhost vagrant]# ls /var/log/ | grep testreboot[Kls /var/log/ | grep testgrep quiet /boot/grub2/grub.cfg [1Prhgb[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[15Pub2-mkconfi[C[C[9@vi /boot/grub2/grub.cf[C[C[1@cat[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Clsinitrd -m /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img | grep test[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cdracut -f -v[K[1Pvi test.sh [1Pchmod +x *do[C[C[C[C[Cvi module-setup.sh [2Pmv testsh test.sh[5Ptouch testshmodule-setup.shcd /usr/lib/dracut/modules.d/01test
]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# vi 0[K
module-setup.sh  test.sh          
[root@localhost 01test]# vi 
module-setup.sh  test.sh          
[root@localhost 01test]# vi test.sh 
[?1049h[?1h=[1;58r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[58;1H"test.sh" 23L, 391C[1;1H#!/bin/bash

exec 0<>/dev/console 1<>/dev/console 2<>/dev/console
cat <<'msgend'
Hello! You are in dracut module!
 ___________________
< I'm dracut module >
 -------------------
   \
    \[11;9H.--.[12;8H|o_o |[13;8H|:_/ |[14;7H//   \ \[15;6H(|     | )
    /'\_   _/`\
    \___)=(___/
msgend

echo "$(date) module test installed" > /var/log/test.log
sleep 30

echo " continuing...."
[1m[34m~                                                                                                              [25;1H~                                                                                                              [26;1H~                                                                                                              [27;1H~                                                                                                              [28;1H~                                                                                                              [29;1H~                                                                                                              [30;1H~                                                                                                              [31;1H~                                                                                                              [32;1H~                                                                                                              [33;1H~                                                                                                              [34;1H~                                                                                                              [35;1H~                                                                                                              [36;1H~                                                                                                              [37;1H~                                                                                                              [38;1H~                                                                                                              [39;1H~                                                                                                              [40;1H~                                                                                                              [41;1H~                                                                                                              [42;1H~                                                                                                              [43;1H~                                                                                                              [44;1H~                                                                                                              [45;1H~                                                                                                              [46;1H~                                                                                                              [47;1H~                                                                                                              [48;1H~                                                                                                              [49;1H~                                                                                                              [50;1H~                                                                                                              [51;1H~                                                                                                              [52;1H~                                                                                                              [53;1H~                                                                                                              [54;1H~                                                                                                              [55;1H~                                                                                                              [56;1H~                                                                                                              [57;1H~                                                                                                              [1;1H[?12l[?25h





















[?25l[m[58;1H[1m-- INSERT --[m[58;13H[K[23;1H[?12l[?25h[22;1H[21;1H
[21;1H[20;1H

[58;1H[K[22;1H[?25l[?12l[?25h[?25l[58;1H:[?12l[?25hq[?25l[58;1H[K[58;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/usr/lib/dracut/modules.d/01test[root@localhost 01test]# exit
exit
]0;vagrant@localhost:~[vagrant@localhost ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;user@centos7:/data/33/9[user@centos7 9]$ exit
exit

Script done on Fri 10 Dec 2021 11:46:01 AM MSK
