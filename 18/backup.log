Script started on 2022-04-06 20:35:38+03:00
]0;user@alma8:/data/33/otus/18[user@alma8 18]$ vagrant ssh s[Kclient
Last login: Wed Apr  6 17:33:29 2022 from 10.0.2.2
]0;vagrant@client:~[?1034h[vagrant@client ~]$ sudo su
]0;root@client:/home/vagrant[?1034h[root@client vagrant]# ssh-keygen 
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:AvxzPf4S9Ann9kQF0u7FOh6CA2WgIuWW7HMb0inmzVc root@client
The key's randomart image is:
+---[RSA 2048]----+
|    .   ..  .... |
|   = . .  o  .. .|
|  . O .  o   . o |
|   + = ...o . o o|
|    * O SoE* + o |
|   o B * o+.* *  |
|    . + . .+ = o |
|       .  ..  o  |
|           ..    |
+----[SHA256]-----+
]0;root@client:/home/vagrant[root@client vagrant]# cat /[K.ssh/id_[K[K[K[K[K[K[K[K[K[K[K[Kcd ~
]0;root@client:~[root@client ~]# cat .ssh/id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDeRkb3dXlRb94RGSQwjsSuyXgYnkSsX2wIhQeUTq6w/STouOEMiIzm/SqAur6nbdpfTVCKqtx4WTQLMpzxCLzAPcPqzn3GjghcPzpD+2BkvBAMwZOp3FaPh5HkF3V8icBsPR0yXDdu/FqK25SJnOOWsRwi05juXrxu5qNdbtCf9KDhTZOZW638qEhZeMWviatCni4yi6wvD1Go1MVG6yJxHDYtOj69ZRRJNdpqcPv28ca5uIhSjdtnbtUDQW+tBHI9z83cQUWiOGQtx/g+x74UfIu1ClAOaJUxti9CBLvqAA3kWX7W1dIU+KOPItfMwd4d3T0Va/8NTR8hK3vEbByX root@client
]0;root@client:~[root@client ~]#  [Kborg
usage: borg [-V] [-h] [--critical] [--error] [--warning] [--info] [--debug]
            [--debug-topic TOPIC] [-p] [--log-json] [--lock-wait SECONDS]
            [--bypass-lock] [--show-version] [--show-rc] [--umask M]
            [--remote-path PATH] [--remote-ratelimit RATE]
            [--consider-part-files] [--debug-profile FILE] [--rsh RSH]
            <command> ...

Borg - Deduplicated Backups

optional arguments:
  -V, --version         show version number and exit

Common options:
  -h, --help            show this help message and exit
  --critical            work on log level CRITICAL
  --error               work on log level ERROR
  --warning             work on log level WARNING (default)
  --info, -v, --verbose
                        work on log level INFO
  --debug               enable debug output, work on log level DEBUG
  --debug-topic TOPIC   enable TOPIC debugging (can be specified multiple
                        times). The logger path is borg.debug.<TOPIC> if TOPIC
                        is not fully qualified.
  -p, --progress        show progress information
  --log-json            Output one JSON object per log line instead of
                        formatted text.
  --lock-wait SECONDS   wait at most SECONDS for acquiring a repository/cache
                        lock (default: 1).
  --bypass-lock         Bypass locking mechanism
  --show-version        show/log the borg version
  --show-rc             show/log the return code (rc)
  --umask M             set umask to M (local and remote, default: 0077)
  --remote-path PATH    use PATH as borg executable on the remote (default:
                        "borg")
  --remote-ratelimit RATE
                        set remote network upload rate limit in kiByte/s
                        (default: 0=unlimited)
  --consider-part-files
                        treat part files like normal files (e.g. to
                        list/extract them)
  --debug-profile FILE  Write execution profile in Borg format into FILE. For
                        local use a Python-compatible file can be generated by
                        suffixing FILE with ".pyprof".
  --rsh RSH             Use this command to connect to the 'borg serve'
                        process (default: 'ssh')

required arguments:
  <command>
    mount               mount repository
    serve               start repository server process
    init                initialize empty repository
    check               verify repository
    key                 manage repository key
    change-passphrase   change repository passphrase
    create              create backup
    extract             extract archive contents
    export-tar          create tarball from archive
    diff                find differences in archive contents
    rename              rename archive
    delete              delete archive
    list                list archive or repository contents
    umount              umount repository
    info                show repository or archive information
    break-lock          break repository and cache locks
    prune               prune archives
    upgrade             upgrade repository format
    recreate            Re-create archives
    with-lock           run user command with lock held
    config              get and set configuration values
    debug               debugging command (not intended for normal use)
    benchmark           benchmark command
]0;root@client:~[root@client ~]# exit
exit
]0;vagrant@client:~[vagrant@client ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;user@alma8:/data/33/otus/18[user@alma8 18]$ vagrant ssh bak
Last login: Wed Apr  6 17:30:40 2022 from 10.0.2.2
]0;vagrant@bak:~[?1034h[vagrant@bak ~]$ sudo su
]0;root@bak:/home/vagrant[?1034h[root@bak vagrant]# su -bor[K[K[K borg
]0;borg@bak:~[?1034h[borg@bak ~]$ vi .ssh/authorized_keys 
[?1049h[?1h=[1;62r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[62;1H".ssh/authorized_keys" 0L, 0C[2;1H[1m[34m~                                                                                                                                                                                                  [3;1H~                                                                                                                                                                                                  [4;1H~                                                                                                                                                                                                  [5;1H~                                                                                                                                                                                                  [6;1H~                                                                                                                                                                                                  [7;1H~                                                                                                                                                                                                  [8;1H~                                                                                                                                                                                                  [9;1H~                                                                                                                                                                                                  [10;1H~                                                                                                                                                                                                  [11;1H~                                                                                                                                                                                                  [12;1H~                                                                                                                                                                                                  [13;1H~                                                                                                                                                                                                  [14;1H~                                                                                                                                                                                                  [15;1H~                                                                                                                                                                                                  [16;1H~                                                                                                                                                                                                  [17;1H~                                                                                                                                                                                                  [18;1H~                                                                                                                                                                                                  [19;1H~                                                                                                                                                                                                  [20;1H~                                                                                                                                                                                                  [21;1H~                                                                                                                                                                                                  [22;1H~                                                                                                                                                                                                  [23;1H~                                                                                                                                                                                                  [24;1H~                                                                                                                                                                                                  [25;1H~                                                                                                                                                                                                  [26;1H~                                                                                                                                                                                                  [27;1H~                                                                                                                                                                                                  [28;1H~                                                                                                                                                                                                  [29;1H~                                                                                                                                                                                                  [30;1H~                                                                                                                                                                                                  [31;1H~                                                                                                                                                                                                  [32;1H~                                                                                                                                                                                                  [33;1H~                                                                                                                                                                                                  [34;1H~                                                                                                                                                                                                  [35;1H~                                                                                                                                                                                                  [36;1H~                                                                                                                                                                                                  [37;1H~                                                                                                                                                                                                  [38;1H~                                                                                                                                                                                                  [39;1H~                                                                                                                                                                                                  [40;1H~                                                                                                                                                                                                  [41;1H~                                                                                                                                                                                                  [42;1H~                                                                                                                                                                                                  [43;1H~                                                                                                                                                                                                  [44;1H~                                                                                                                                                                                                  [45;1H~                                                                                                                                                                                                  [46;1H~                                                                                                                                                                                                  [47;1H~                                                                                                                                                                                                  [48;1H~                                                                                                                                                                                                  [49;1H~                                                                                                                                                                                                  [50;1H~                                                                                                                                                                                                  [51;1H~                                                                                                                                                                                                  [52;1H~                                                                                                                                                                                                  [53;1H~                                                                                                                                                                                                  [54;1H~                                                                                                                                                                                                  [55;1H~                                                                                                                                                                                                  [56;1H~                                                                                                                                                                                                  [57;1H~                                                                                                                                                                                                  [58;1H~                                                                                                                                                                                                  [59;1H~                                                                                                                                                                                                  [60;1H~                                                                                                                                                                                                  [61;1H~                                                                                                                                                                                                  [1;1H[?12l[?25h[?25l[m[62;1H[1m-- INSERT --[m[62;13H[K[1;1H[?12l[?25h[?25lssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDeRkb3dXlRb94RGSQwjsSuyXgYnkSsX2wIhQeUTq6w/STouOEMiIzm/SqAur6nbdpfTVCKqtx4WTQLMpzxCLzAPcPqzn3GjghcPzpD+2BkvBAMwZOp3FaPh5HkF3V8icBsPR0yXDdu/FqK25SJnOOWsRwi05jj[2;1HuXrxu5qNdbtCf9KDhTZOZW638qEhZeMWviatCni4yi6wvD1Go1MVG6yJxHDYtOj69ZRRJNdpqcPv28ca5uIhSjdtnbtUDQW+tBHI9z83cQUWiOGQtx/g+x74UfIu1ClAOaJUxti9CBLvqAA3kWX7W1dIU+KOPItfMwd4d3T0Va/8NTR8hK3vEbByX root@cliee[3;1Hnt[3;3H[K[4;1H[K[4;1H[?12l[?25h[?25l:[?12l[?25h[?25lw[?12l[?25h[?25l[4;2H[K[4;2H[?12l[?25h[?25l[4;1H[K[4;1H[?12l[?25h[62;1H[K[4;1H[?25l[?12l[?25h[?25l[62;1H:[?12l[?25hwq![?25l".ssh/authorized_keys" 2L, 394C written
[?1l>[?12l[?25h[?1049l]0;borg@bak:~[borg@bak ~]$ exit[K[K[K[Kmount -t ext4
/dev/sdb1 on /var/backup type ext4 (rw,relatime,seclabel,data=ordered)
]0;borg@bak:~[borg@bak ~]$ ls -la /d[K[Kva[K[K/var/backup/
total 4
drwxr-xr-x.  2 borg borg 4096 Apr  6 17:30 [0m[01;34m.[0m
drwxr-xr-x. 19 root root  268 Apr  6 17:30 [01;34m..[0m
]0;borg@bak:~[borg@bak ~]$ exit
logout
]0;root@bak:/home/vagrant[root@bak vagrant]# eixt
bash: eixt: command not found
]0;root@bak:/home/vagrant[root@bak vagrant]# exit
exit
]0;vagrant@bak:~[vagrant@bak ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;user@alma8:/data/33/otus/18[user@alma8 18]$ vagrant ssh clien
]0;user@alma8:/data/33/otus/18[user@alma8 18]$ vagrant ssh client
Last login: Wed Apr  6 17:35:40 2022 from 10.0.2.2
]0;vagrant@client:~[?1034h[vagrant@client ~]$ su -
Password: 
]0;vagrant@client:~[vagrant@client ~]$ sudo su
]0;root@client:/home/vagrant[?1034h[root@client vagrant]# #=REPO=borg@192.168.11.10:/var/backup/
]0;root@client:/home/vagrant[root@client vagrant]# #=REPO=borg@192.168.11.10:/var/backup/[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P=REPO=borg@192.168.11.10:/var/backup/[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1PREPO=borg@192.168.11.10:/var/backup/[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
]0;root@client:/home/vagrant[root@client vagrant]# borg init --repokey {[K${REPO}
usage: borg init [-h] [--critical] [--error] [--warning] [--info] [--debug]
                 [--debug-topic TOPIC] [-p] [--log-json] [--lock-wait SECONDS]
                 [--bypass-lock] [--show-version] [--show-rc] [--umask M]
                 [--remote-path PATH] [--remote-ratelimit RATE]
                 [--consider-part-files] [--debug-profile FILE] [--rsh RSH] -e
                 MODE [--append-only] [--storage-quota QUOTA]
                 [--make-parent-dirs]
                 [REPOSITORY]
borg init: error: the following arguments are required: -e/--encryption
]0;root@client:/home/vagrant[root@client vagrant]# borg init --repokey ${REPO}[1P[1P[1@-[1@-[1@e[1@n[1@c[C[1@r[1@i[1@p[1@t[1@i[1@o[1@n[1@=
usage: borg init [-h] [--critical] [--error] [--warning] [--info] [--debug]
                 [--debug-topic TOPIC] [-p] [--log-json] [--lock-wait SECONDS]
                 [--bypass-lock] [--show-version] [--show-rc] [--umask M]
                 [--remote-path PATH] [--remote-ratelimit RATE]
                 [--consider-part-files] [--debug-profile FILE] [--rsh RSH] -e
                 MODE [--append-only] [--storage-quota QUOTA]
                 [--make-parent-dirs]
                 [REPOSITORY]
borg init: error: the following arguments are required: -e/--encryption
]0;root@client:/home/vagrant[root@client vagrant]# borg init --encription=repokey ${REPO}[1P[1@y
The authenticity of host '192.168.11.10 (192.168.11.10)' can't be established.
ECDSA key fingerprint is SHA256:WtuIfgbornirsoGTc71Srjn2biOgehlZTqUOsbNEYVQ.
ECDSA key fingerprint is MD5:57:74:53:3d:15:90:da:b1:f5:e6:28:2c:30:57:6b:41.
Are you sure you want to continue connecting (yes/no)? yes
Remote: Warning: Permanently added '192.168.11.10' (ECDSA) to the list of known hosts.
Enter new passphrase: 
Enter same passphrase again: 
Do you want your passphrase to be displayed for verification? [yN]: y
Your passphrase (between double-quotes): "cheese"
Make sure the passphrase displayed above is exactly what you wanted.

By default repositories initialized with this version will produce security
errors if written to with an older version (up to and including Borg 1.0.8).

If you want to use these older versions, you can disable the check by running:
borg upgrade --disable-tam ssh://borg@192.168.11.10/var/backup

See https://borgbackup.readthedocs.io/en/stable/changes.html#pre-1-0-9-manifest-spoofing-vulnerability for details about the security implications.

IMPORTANT: you will need both KEY AND PASSPHRASE to access this repo!
If you used a repokey mode, the key is stored in the repo, but you should back it up separately.
Use "borg key export" to export the key, optionally in printable format.
Write down the passphrase. Store both at safe place(s).

]0;root@client:/home/vagrant[root@client vagrant]# systemctl enable bor-[Kg-backup.service
]0;root@client:/home/vagrant[root@client vagrant]# systemctl enable borg-backup.service¸¸[K[K[7Pborg-backup.servicesborg-backup.servicetborg-backup.serviceaborg-backup.servicerborg-backup.servicetborg-backup.service borg-backup.service
]0;root@client:/home/vagrant[root@client vagrant]# systemctl start borg-backup.service[K[K[K[K[K[K[Ktimer[6Pborg-backup.timereborg-backup.timernborg-backup.timeraborg-backup.timer[Cborg-backup.timerlborg-backup.timereborg-backup.timer borg-backup.timer
Created symlink from /etc/systemd/system/timers.target.wants/borg-backup.timer to /etc/systemd/system/borg-backup.timer.
]0;root@client:/home/vagrant[root@client vagrant]# systemctl enable borg-backup.timer[1@²[1P[1P[1P[1P[1P[1P[1P borg-backup.timers borg-backup.timert borg-backup.timera borg-backup.timerr borg-backup.timert borg-backup.timer
]0;root@client:/home/vagrant[root@client vagrant]# echo 777 > /etc/hostname
]0;root@client:/home/vagrant[root@client vagrant]# ca[K[K/[Kcat/[K /etc/hostname 
777
]0;root@client:/home/vagrant[root@client vagrant]# borg list
usage: borg list [-h] [--critical] [--error] [--warning] [--info] [--debug]
                 [--debug-topic TOPIC] [-p] [--log-json] [--lock-wait SECONDS]
                 [--bypass-lock] [--show-version] [--show-rc] [--umask M]
                 [--remote-path PATH] [--remote-ratelimit RATE]
                 [--consider-part-files] [--debug-profile FILE] [--rsh RSH]
                 [--short] [--format FORMAT] [--json] [--json-lines]
                 [-P PREFIX | -a GLOB] [--sort-by KEYS] [--first N | --last N]
                 [-e PATTERN] [--exclude-from EXCLUDEFILE] [--pattern PATTERN]
                 [--patterns-from PATTERNFILE]
                 [REPOSITORY_OR_ARCHIVE] [PATH [PATH ...]]
borg list: error: argument REPOSITORY_OR_ARCHIVE: Invalid location format: ""
]0;root@client:/home/vagrant[root@client vagrant]# borg list ${REPO}
Enter passphrase for key ssh://borg@192.168.11.10/var/backup: 
etc-2022-04-06_17:39:02              Wed, 2022-04-06 17:39:05 [724fd82c4343a3af899d9e889e42bf40a1bb10e68064e67d2e48cfec0cdb8823]
]0;root@client:/home/vagrant[root@client vagrant]# borg list ${REPO}[K ${REPO}[1@²[1P[1P[1P[1P[1P ${REPO}e ${REPO}x ${REPO}t ${REPO}r ${REPO}a ${REPO}c ${REPO}t ${REPO}[C[C[C[C[C[C[C[C""[K[K::  /etc/hostname[C[C[C[C[C[C[C[1@e[1@t[1@c[1@-[1@2[1@0[1@2[1@2[1@-[1@0[1@4[1@-[1@0[1@6[1@_[1@1[1@7[1@:[1@3[1@9[1@:[1@0[1@2[C[C /etc/hostname[C[C[C[1Petc/hostname[1Petc/hostname
Enter passphrase for key ssh://borg@192.168.11.10/var/backup: 
]0;root@client:/home/vagrant[root@client vagrant]# ls
[0m[01;34metc[0m
]0;root@client:/home/vagrant[root@client vagrant]# mv etc/hostname /etc/hostname 
mv: overwrite â€˜/etc/hostnameâ€™? y
]0;root@client:/home/vagrant[root@client vagrant]# cat /etc/hostname 
client
]0;root@client:/home/vagrant[root@client vagrant]# [1P(reverse-i-search)`':[Cl': lsi': borg list ${REPO}[1@s[C[C[C[C[C[C[C[C[2P[root@client vagrant]#[C[C[C[C[C[C
Enter passphrase for key ssh://borg@192.168.11.10/var/backup: 
etc-2022-04-06_17:39:02              Wed, 2022-04-06 17:39:05 [724fd82c4343a3af899d9e889e42bf40a1bb10e68064e67d2e48cfec0cdb8823]
]0;root@client:/home/vagrant[root@client vagrant]# date
Wed Apr  6 17:42:56 UTC 2022
]0;root@client:/home/vagrant[root@client vagrant]# ei[Kxit
exit
]0;vagrant@client:~[vagrant@client ~]$ exit
logout
Connection to 127.0.0.1 closed.
]0;user@alma8:/data/33/otus/18[user@alma8 18]$ exit
exit

Script done on 2022-04-06 20:43:21+03:00
